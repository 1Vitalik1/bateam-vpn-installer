#################################################
# OpenVPN Server Configuration
# With obfuscation support
#################################################

# Network Settings
port 1194
proto tcp
dev tun
topology subnet

# SSL/TLS root certificate (ca), certificate
# (cert), and private key (key)
ca /etc/openvpn/pki/ca.crt
cert /etc/openvpn/pki/issued/server.crt
key /etc/openvpn/pki/private/server.key

# Diffie hellman parameters
dh /etc/openvpn/pki/dh.pem

# TLS authentication
tls-auth /etc/openvpn/pki/ta.key 0

# Network topology
server 10.8.0.0 255.255.255.0

# Maintain a record of client <-> virtual IP address
ifconfig-pool-persist /var/log/openvpn/ipp.txt

# Push routes to the client
push "redirect-gateway def1 bypass-dhcp"

# DNS servers
push "dhcp-option DNS 10.8.0.1"
push "dhcp-option DNS 1.1.1.1"
push "dhcp-option DNS 8.8.8.8"

# Client config directory
client-config-dir /etc/openvpn/ccd

# Keepalive settings
# Ping every 10 seconds, assume that remote
# peer is down if no ping received during
# a 120 second time period
keepalive 10 120

# Cryptographic cipher
cipher AES-256-GCM
auth SHA512

# Enable TLS 1.2 minimum
tls-version-min 1.2

# Select cryptographic cipher for TLS
tls-cipher TLS-ECDHE-RSA-WITH-AES-256-GCM-SHA384:TLS-ECDHE-RSA-WITH-AES-128-GCM-SHA256:TLS-DHE-RSA-WITH-AES-256-GCM-SHA384

# Enable compression (optional, may reduce speed)
# Uncomment if needed
;compress lz4-v2
;push "compress lz4-v2"

# Maximum number of concurrent clients
max-clients 100

# Run with reduced privileges
user nobody
group nogroup

# Persist certain options that may no longer be available
# after privilege downgrade
persist-key
persist-tun

# Output a short status file
status /var/log/openvpn/openvpn-status.log

# Log file
log-append /var/log/openvpn/openvpn.log

# Set the appropriate level of log verbosity
# 0 is silent, except for fatal errors
# 4 is reasonable for general usage
# 5 and 6 can help to debug connection problems
# 9 is extremely verbose
verb 3

# Silence repeating messages
mute 20

# Notify the client that when the server restarts
# so it can automatically reconnect
explicit-exit-notify 1

# Performance tuning
sndbuf 393216
rcvbuf 393216
push "sndbuf 393216"
push "rcvbuf 393216"

# Use fast I/O operations
fast-io

# TCP optimizations (only for TCP mode)
tcp-nodelay

# Allow multiple clients with the same common name
# Uncomment if needed
;duplicate-cn

# Client-to-client communication
# Uncomment to allow clients to reach each other
;client-to-client

# Script security
script-security 2

# Optional: Run script when client connects/disconnects
;client-connect /etc/openvpn/scripts/client-connect.sh
;client-disconnect /etc/openvpn/scripts/client-disconnect.sh

# Optional: Learn client IP addresses
;learn-address /etc/openvpn/scripts/learn-address.sh

# CRL (Certificate Revocation List)
# Uncomment when you need to revoke certificates
;crl-verify /etc/openvpn/pki/crl.pem

# Management interface (for monitoring)
# Uncomment to enable management interface
;management localhost 7505

# Obfuscation options
# This will be added by entrypoint.sh if OPENVPN_ENABLE_OBFUSCATION=true
# scramble obfuscate your_password_here